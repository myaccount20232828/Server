name: Run Server with ngrok

on: [push]

jobs:
  server:
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install ngrok
      run: |
        brew install ngrok

    - name: Make server executable
      run: |
        #chmod +x server

    - name: Run server
      run: |
        #./server &
        cd /
        python -m SimpleHTTPServer 8080 &
        echo "Server started"

    - name: Start ngrok
      run: |
        nohup ngrok http 8080 > /dev/null &
        sleep 10
        curl -s http://localhost:4040/api/tunnels | jq -r '.tunnels[0].public_url' > ngrok_url.txt

    - name: Display ngrok URL
      run: |
        cat ngrok_url.txt
